
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Linear Programming (Optimization) &#8212; From Excel to Pandas</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.37f24b989f4638ff9c27c22dc7559d4f.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Survey Analysis" href="08.04_Survey_analysis.html" />
    <link rel="prev" title="Currency Rate Analysis" href="08.02_Currency_analysis.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">From Excel to Pandas</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to the tutorial ‚Äúfrom-Excel-to-Pandas‚Äù for data analysis
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html">
   Install Locally
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html#open-in-aws-sagemaker-studio-lab">
   Open in AWS SageMaker Studio Lab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html#open-in-binder-colab">
   Open in Binder/Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html#open-in-visual-studio-code">
   Open in Visual Studio Code
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Loading Data
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01.01%20-%20loading%20files.html">
   Loading Data Files (CSV or XLSX)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01.02%20-%20loading%20data%20from%20HTML.html">
   Reading Data from Web Sites
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01.03_loading_data_from_API.html">
   Reading Data from External API
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Adding Columns
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="02.01_Adding_New_Columns.html">
   Adding New Columns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02.02_date_functions.html">
   Date Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02.08_group_values.html">
   Categories from numeric values
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Table Aggregation and Reshaping
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="03.01_pivot_tables.html">
   Creating a Pivot Table
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03.02_group_by.html">
   Split a Table into Groups
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Table Enrichment with Merge
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="03.03_merge.html">
   Merge/Join Tables (VLOOKUP)
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Industries Use Cases
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="08.01_Logistics_analysis.html">
   Logistics Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08.02_Currency_analysis.html">
   Currency Rate Analysis
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Linear Programming (Optimization)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08.04_Survey_analysis.html">
   Survey Analysis
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/08.03_Linear_optimization.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://gesis.mybinder.org/binder/v2/gh/aiola-lab/from-excel-to-pandas//v2/gh/executablebooks/jupyter-book/master?urlpath=tree/notebooks/08.03_Linear_optimization.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-the-data">
   Loading the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installing-the-lp-library">
   Installing the LP Library
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#defining-the-problem-variables">
   Defining the problem variables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-target">
     Problem target
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#variable-dictionaries">
     Variable Dictionaries
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linear-programming-lp-definition">
     Linear Programming (LP) Definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lp-solution">
     LP Solution
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="linear-programming-optimization">
<h1>Linear Programming (Optimization)<a class="headerlink" href="#linear-programming-optimization" title="Permalink to this headline">¬∂</a></h1>
<p>In this example, we will use an common analysis that is used to optimize decision based on constrains, and it is based on the great blog post <a class="reference external" href="https://towardsdatascience.com/how-to-solve-optimization-problems-with-python-9088bf8d48e5">How to Solve Optimization Problems with Python</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="loading-the-data">
<h2>Loading the data<a class="headerlink" href="#loading-the-data" title="Permalink to this headline">¬∂</a></h2>
<p>We will get the data from HTML table that are available from <a class="reference external" href="http://rotoguru.net">Rotoguru</a>, that is gather stats data from fantasy league. We will focus on the data of the NBA players. To keep the consistency of the notebook, we will check the data for a specific week (‚Äò2021-03-02‚Äô)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_url</span> <span class="o">=</span> <span class="s1">&#39;http://rotoguru1.com/cgi-bin/hyday.pl?mon=3&amp;day=2&amp;year=2021&amp;game=fd&#39;</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span>
    <span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">data_url</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There are a few HTML table in the page, and after some scorlling we can see that the table with the players data is the 6th one (index=5):</p>
<ul class="simple">
<li><p>Start with the dataframe at index 5 of the list of table from the HTML page above</p></li>
<li><p>Rename the column to be: Position, Name,FD Points, Salary, Team, Opp., Score, Min, Stats</p></li>
<li><p>Filter out rows with Position string longer than 2 characters (header lines)</p></li>
<li><p>Add a column called <em>Points</em> with the float value of the points to be used as the target of the optimization</p></li>
<li><p>Remove the dollar sign and commas ([$,]) from the Salary column and convert it to its integer value</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_players</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dfs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span><span class="s1">&#39;Position&#39;</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;FD Points&#39;</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Salary&#39;</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Team&#39;</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span><span class="s1">&#39;Opp.&#39;</span><span class="p">,</span>
            <span class="mi">6</span><span class="p">:</span><span class="s1">&#39;Score&#39;</span><span class="p">,</span>
            <span class="mi">7</span><span class="p">:</span><span class="s1">&#39;Min&#39;</span><span class="p">,</span>
            <span class="mi">8</span><span class="p">:</span><span class="s1">&#39;Stats&#39;</span>
            <span class="p">}</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;Position.str.len() &lt;= 2&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Points</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;FD Points&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Salary</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Salary</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[$,]&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">all_players</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">163</span><span class="n">b13cc065d</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">all_players</span> <span class="o">=</span> <span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">dfs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>         <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>             <span class="mi">0</span><span class="p">:</span><span class="s1">&#39;Position&#39;</span><span class="p">,</span>

<span class="nn">~/opt/anaconda3/lib/python3.8/site-packages/pandas/core/frame.py</span> in <span class="ni">query</span><span class="nt">(self, expr, inplace, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">3467</span>         <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="g g-Whitespace">   </span><span class="mi">3468</span>         <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">3469</span>         <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3470</span> 
<span class="g g-Whitespace">   </span><span class="mi">3471</span>         <span class="k">try</span><span class="p">:</span>

<span class="nn">~/opt/anaconda3/lib/python3.8/site-packages/pandas/core/frame.py</span> in <span class="ni">eval</span><span class="nt">(self, expr, inplace, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">3597</span>         <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;resolvers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resolvers&quot;</span><span class="p">,</span> <span class="p">())</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">resolvers</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3598</span> 
<span class="ne">-&gt; </span><span class="mi">3599</span>         <span class="k">return</span> <span class="n">_eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3600</span> 
<span class="g g-Whitespace">   </span><span class="mi">3601</span>     <span class="k">def</span> <span class="nf">select_dtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>

<span class="nn">~/opt/anaconda3/lib/python3.8/site-packages/pandas/core/computation/eval.py</span> in <span class="ni">eval</span><span class="nt">(expr, parser, engine, truediv, local_dict, global_dict, resolvers, level, target, inplace)</span>
<span class="g g-Whitespace">    </span><span class="mi">345</span>         <span class="n">eng</span> <span class="o">=</span> <span class="n">ENGINES</span><span class="p">[</span><span class="n">engine</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">346</span>         <span class="n">eng_inst</span> <span class="o">=</span> <span class="n">eng</span><span class="p">(</span><span class="n">parsed_expr</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">347</span>         <span class="n">ret</span> <span class="o">=</span> <span class="n">eng_inst</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">348</span> 
<span class="g g-Whitespace">    </span><span class="mi">349</span>         <span class="k">if</span> <span class="n">parsed_expr</span><span class="o">.</span><span class="n">assigner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">~/opt/anaconda3/lib/python3.8/site-packages/pandas/core/computation/engines.py</span> in <span class="ni">evaluate</span><span class="nt">(self)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> 
<span class="g g-Whitespace">     </span><span class="mi">72</span>         <span class="c1"># make sure no names in resolvers and locals/globals clash</span>
<span class="ne">---&gt; </span><span class="mi">73</span>         <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>         <span class="k">return</span> <span class="n">reconstruct_object</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span>             <span class="bp">self</span><span class="o">.</span><span class="n">result_type</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aligned_axes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">return_type</span>

<span class="nn">~/opt/anaconda3/lib/python3.8/site-packages/pandas/core/computation/engines.py</span> in <span class="ni">_evaluate</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">111</span>         <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">env</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span>         <span class="n">scope</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">full_scope</span>
<span class="ne">--&gt; </span><span class="mi">113</span>         <span class="n">_check_ne_builtin_clash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span>         <span class="k">return</span> <span class="n">ne</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">local_dict</span><span class="o">=</span><span class="n">scope</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span> 

<span class="nn">~/opt/anaconda3/lib/python3.8/site-packages/pandas/core/computation/engines.py</span> in <span class="ni">_check_ne_builtin_clash</span><span class="nt">(expr)</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span>         <span class="n">Terms</span> <span class="n">can</span> <span class="n">contain</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>     <span class="s2">&quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">29</span><span class="s2">     names = expr.names</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span><span class="s2">     overlap = names &amp; _ne_builtins</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span><span class="s2"> </span>

<span class="nn">~/opt/anaconda3/lib/python3.8/site-packages/pandas/core/computation/expr.py</span> in <span class="ni">names</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">824</span><span class="s2">         if is_term(self.terms):</span>
<span class="g g-Whitespace">    </span><span class="mi">825</span><span class="s2">             return frozenset([self.terms.name])</span>
<span class="nn">--&gt; 826         return frozenset(term.name for term</span> in <span class="ni">com.flatten</span><span class="nt">(self.terms))</span>
<span class="g g-Whitespace">    </span><span class="mi">827</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">828</span><span class="s2"> </span>

<span class="ne">TypeError</span>: unhashable type: &#39;numpy.ndarray&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="installing-the-lp-library">
<h2>Installing the LP Library<a class="headerlink" href="#installing-the-lp-library" title="Permalink to this headline">¬∂</a></h2>
<p>Many times you can find a python library that is implementing many of the fucntions that you need. This is another major benefit of Python over close tools such as Excel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pulp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: pulp in /usr/local/lib/python3.9/site-packages (2.4)
Requirement already satisfied: amply&gt;=0.1.2 in /usr/local/lib/python3.9/site-packages (from pulp) (0.1.4)
Requirement already satisfied: docutils&gt;=0.3 in /usr/local/lib/python3.9/site-packages (from amply&gt;=0.1.2-&gt;pulp) (0.16)
Requirement already satisfied: pyparsing in /usr/local/lib/python3.9/site-packages (from amply&gt;=0.1.2-&gt;pulp) (2.4.7)
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="defining-the-problem-variables">
<h2>Defining the problem variables<a class="headerlink" href="#defining-the-problem-variables" title="Permalink to this headline">¬∂</a></h2>
<p>The most complicated part of the analysis is to understand how to map it into the domain of the algorithm.</p>
<p>The current problem that we want to solve using Linear Programming (LP) is what is the best roaster of NBA players we want to choose for our fantasy league. The output is this case is the list of the players names.</p>
<p>We will create a list of all the players and assign them either 1 (selected to the team) or 0 (not selected)</p>
<ul class="simple">
<li><p>Create a Linear Programming variables</p></li>
<li><p>from a dictionary</p></li>
<li><p>with no prefix to the names</p></li>
<li><p>and index of <span class="math notranslate nohighlight">\(x_i\)</span> as the player names</p></li>
<li><p>and the value is an Integer</p></li>
<li><p>that is either 0 (not selected)</p></li>
<li><p>or 1 (selected)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pulp</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">player_vars</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">LpVariable</span>
    <span class="o">.</span><span class="n">dicts</span><span class="p">(</span>
        <span class="s1">&#39;&#39;</span><span class="p">,</span> 
        <span class="nb">list</span><span class="p">(</span><span class="n">all_players</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]),</span> 
        <span class="n">cat</span><span class="o">=</span><span class="s1">&#39;Integer&#39;</span><span class="p">,</span>
        <span class="n">lowBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
        <span class="n">upBound</span><span class="o">=</span><span class="mi">1</span> 
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="problem-target">
<h3>Problem target<a class="headerlink" href="#problem-target" title="Permalink to this headline">¬∂</a></h3>
<p>In the fantasy league games, we want to maximize the number of points that the player that we choose will score in the next game.</p>
<p>Let‚Äôs start with defining the LP problem as a maximization problem:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_score</span> <span class="o">=</span> <span class="n">LpProblem</span><span class="p">(</span><span class="s1">&#39;Fantasy Points Problem&#39;</span><span class="p">,</span> <span class="n">LpMaximize</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="variable-dictionaries">
<h3>Variable Dictionaries<a class="headerlink" href="#variable-dictionaries" title="Permalink to this headline">¬∂</a></h3>
<p>The library is expecting to get a set of dictionaries each with the name of the player as the common index and the numeric value for each. We will do that for the Points (the target to maximize), the Positions (that we need to pick a couple of each position), and the Salaries (that we need to cap to a specific limit).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">points</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">all_players</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="p">[</span><span class="s1">&#39;Points&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">salaries</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">all_players</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="p">[</span><span class="s1">&#39;Salary&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="linear-programming-lp-definition">
<h3>Linear Programming (LP) Definition<a class="headerlink" href="#linear-programming-lp-definition" title="Permalink to this headline">¬∂</a></h3>
<p>The LP problem is defined as a set of linear expressions of the form:</p>
<p><span class="math notranslate nohighlight">\(ùëé_1ùë•_1+ùëé_2ùë•_2+ùëé_3ùë•_3+...ùëé_ùëõùë•_ùëõ {&lt;=,=,&gt;=} ùëè\)</span></p>
<p>Where <span class="math notranslate nohighlight">\(x_1, x_2 ... x_n\)</span> are the <em>decision</em> variables we want to choose (the player names), and <span class="math notranslate nohighlight">\(a_1, a_2, ... a_n\)</span> are the <em>objective</em> and <em>constrains</em> variables we have in our data.</p>
<p>First, we add the LP sum of the points where <span class="math notranslate nohighlight">\(a_i\)</span> is the points each player scored, and <span class="math notranslate nohighlight">\(x_i\)</span> is the player:</p>
<p>total score = <span class="math notranslate nohighlight">\(\sum p_i*x_i\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p_i\)</span> - points scored by player<span class="math notranslate nohighlight">\(_i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( x_i = \begin{cases} 
    1 &amp; \text{if player in team} \\
    0 &amp; \text{if player not in team} 
 \end{cases}
\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_score</span> <span class="o">+=</span> <span class="p">(</span>
    <span class="n">lpSum</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">points</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">*</span> <span class="n">player_vars</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> 
            <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">player_vars</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In a real application we will want to have the projected number of points and not the sum of past points, and we will calculated a forecasting model that can identify trends or recent injuries. But for this simple example, we will take that sum as a good estimator for their expected points in the next game.</p>
<p>Second, we add the constrain the salaries where <span class="math notranslate nohighlight">\(a_i\)</span> is the salary of each player, and <span class="math notranslate nohighlight">\(x_i\)</span> is the player, and the constrain value for the sum of all the salaries of the players we choose not to exceed $60,000:</p>
<p><span class="math notranslate nohighlight">\(\sum s_i*x_i &lt;= 60,000\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(s_i\)</span> - salary of player<span class="math notranslate nohighlight">\(_i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( x_i = \begin{cases} 
    1 &amp; \text{if player in team} \\
    0 &amp; \text{if player not in team} 
 \end{cases}
\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_score</span> <span class="o">+=</span> <span class="p">(</span>
    <span class="n">lpSum</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">salaries</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">*</span> <span class="n">player_vars</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> 
            <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">player_vars</span>
        <span class="p">]</span>
    <span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">60_000</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Last, we want to make sure that we have the right number of players in each position in the fantasy team. We will create a list of players for each of the positions: Point Guard (PG), Shooting Guard (SG), Small Forward (SF), Power Forward (PF), and Center (C)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">all_players</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Position == &#39;PG&#39;&quot;</span><span class="p">)</span>
    <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">sg</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">all_players</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Position == &#39;SG&#39;&quot;</span><span class="p">)</span>
    <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">sf</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">all_players</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Position == &#39;SF&#39;&quot;</span><span class="p">)</span>
    <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">pf</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">all_players</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Position == &#39;PF&#39;&quot;</span><span class="p">)</span>
    <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">all_players</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Position == &#39;C&#39;&quot;</span><span class="p">)</span>
    <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And add the constrains to have exactly two PG, two SG, two SF, two PF and one C:</p>
<p><span class="math notranslate nohighlight">\(\sum x_i = 2  , \text{if player is in PG, SG, SF, PF} \\
 \sum x_i = 1 , \text{if player is in C} 
 \)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( x_i = \begin{cases} 
   1 &amp; \text{if player in team} \\
   0 &amp; \text{if player not in team} 
\end{cases}
\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set Constraints</span>
<span class="n">total_score</span> <span class="o">+=</span> <span class="n">lpSum</span><span class="p">([</span><span class="n">player_vars</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">pg</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">total_score</span> <span class="o">+=</span> <span class="n">lpSum</span><span class="p">([</span><span class="n">player_vars</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">sg</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">total_score</span> <span class="o">+=</span> <span class="n">lpSum</span><span class="p">([</span><span class="n">player_vars</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">sf</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">total_score</span> <span class="o">+=</span> <span class="n">lpSum</span><span class="p">([</span><span class="n">player_vars</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">pf</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">total_score</span> <span class="o">+=</span> <span class="n">lpSum</span><span class="p">([</span><span class="n">player_vars</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="lp-solution">
<h3>LP Solution<a class="headerlink" href="#lp-solution" title="Permalink to this headline">¬∂</a></h3>
<p>Finally, we can solve the set of linear expressions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_score</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<p>And filter the list of the possible players to the ones that were selected (their variable value is 1):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span> 
    <span class="nb">list</span><span class="p">(</span>
        <span class="nb">filter</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">varValue</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> 
            <span class="n">total_score</span><span class="o">.</span><span class="n">variables</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[_Ball,_LaMelo^,
 _Bridges,_Miles,
 _Green,_Draymond^,
 _Hachimura,_Rui^,
 _Monk,_Malik,
 _Murray,_Dejounte^,
 _Oladipo,_Victor^,
 _Porzingis,_Kristaps^,
 _Valanciunas,_Jonas^]
</pre></div>
</div>
</div>
</div>
<p>The list of the players above is changing every week based on their recent performance, and we can execute this analysis every time before we define our fantasy team for the next round.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="08.02_Currency_analysis.html" title="previous page">Currency Rate Analysis</a>
    <a class='right-next' id="next-link" href="08.04_Survey_analysis.html" title="next page">Survey Analysis</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Aiola Team<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>